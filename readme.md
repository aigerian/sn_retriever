# Инструкция
0. Если уже имеются наработки и есть данные в БД, извлеченные при помощи walker_ttr то следует выполнить 

```
python update.py
```
Для обновления этих данных, дабы они были совместимы с последующими извлечениями. 

1. Установить python версии 2.7.6. (active state)
  * Настроить виртуальное окружение выполнив команду 
```
virtualenv <путь где оно будет хранится>
```
  * Применить виртуальное окружение командой 
```
cmd /k <путь где оно хранится>\Scripts\activate.bat 
```
  * Успешным результатом применения будет подпись перед вводом приглашения командной строки, к примеру, так:
```
(venv) C:\>
```
  * Далее в этой инструкции, если требуется выполнить команду в виртуальном окружении, то будет пометка: (venv). Виртуальное окружение требуется для того чтобы в дальнейшем не возникало конфликтов python библиотек. 

2. Установить git и склонировать проект, выполнив команду: 
```
git clone http://github.com/alexeyproskuryakov/ttr_retr 
```
Для копирования исходных кодов проекта. И перейти в папку с проектом (выполнить команду cd ttr_retr).

3. Для установки необходимых библиотек. В примененном виртуальном окружении выполнить команду: 
```
(venv) pip install -r requirements.txt 
```

> Могут возникнуть проблемы с установкой библиотек lxml, numpy (точнее с их компиляцией). В таком случае, с сайта http://www.lfd.uci.edu/~gohlke/pythonlibs/ можно скачать ее скомпилированную версию (под версию python 2.7.6) и установить как обычную windows программу. После, для добавления ее в виртуальное окружение просто скопировать из корневого python окружения в созданное ранее виртуальное, т.е. скопировать папку lxml из c:\python27\lib\site-packages в <путь где хранится созданное виртуальное окружение>\lib\site-packages\.
Вообще, на вышеуказанном сайте можно скачать почти все платформозависимые библиотеки для python. 

  * Либо установить библиотеки последовательно:
```
pip install pymongo redis requests
```

4. Скачать и установить базы данных: 
  * MongoDB - скачать с оффициального сайта www.mongodb.com/downoloads и установить.
После скачивания извлечь из архива содержимое, к примеру, в c:\mongo. Для просмотра содержимого БД рекомендуется использовать бесплатное приложение robomongo 
  * Redis - скачать с официального сайта www.redis.io/downloads и извлечь из архива содержимое, к примеру, в c:\redis.

5. В проекте имеется уже созданный bat файл для запуска серверов обоих БД с названием 
```
start_environment.bat
```
6. Для запуска системы извлечения данных из какой-либо социальной сети в корне проекта имеется файл с названием 
```	
walker_<имя социальной сети>.py <ник_пользователя> <тип_связи> 
```
 В параметрах следует указать: 
  * Ник пользователя с которого следует начинать обход. 
  * Тип связи по которому будут происходить переходы (опционально, по умолчанию friends)
 
> К примеру, если выполнить
```
	(venv) python walker_ttr.py medvedevrussia followers 
```
> Система начнет извлекать данные пользователей и их сообщения начиная с Дмитрия Медведева, передвигаясь по его подписчикам. И сохранять извлеченные данные в mongoDB в коллекцию users. Поля записей могут отличатся в зависимости от социальной сети, но все схожи полями: 
	sn_id - идентификатор в социальной сети
	update_date - время когда были извлечены данные
	screen_name - ник пользователя
	и прочее.
	
8. Система слежения представлена файлами: 
```
	tracker_<имя социальной сети>.py 
```
   Для ее работы требуется иметь в БД уже извлеченные данные пользователей, флагом является поле update_date ранее которого будет извлекаться данные. Для запуска системы следует выполнить команду: 

```
	(venv) python tracker_<имя социальной сети>.py  
```

  * В параметрах можно указать время после которого следует следить за пользователем в секундах. Если его не указывать, то система возьмет это значение из файла properties.py


## Описание полей для объектов пользователей из социальной сети vkontakte

* sex - возвращаемые значения: 1 - женский, 2 - мужской, 0 - без указания пола. 

* bdate - Дата рождения, выдаётся в формате: "23.11.1981" или "21.9" (если год скрыт). Если дата рождения скрыта целиком, то при приёме данных в формате XML в узле <user> отсутствует тег bdate. 

* city - выдаётся id города, указанного у пользователя в разделе "Контакты". Название города по его id можно узнать при помощи метода getCities. Если город не указан, то при приёме данных в формате XML в узле <user> отсутствует тег city. 

* country - выдаётся id страны, указанной у пользователя в разделе "Контакты". Название страны по её id можно узнать при помощи метода getCountries. Если страна не указана, то при приёме данных в формате XML в узле <user> отсутствует тег country. 

* online - показывает, находится ли этот пользователь сейчас на сайте. Поле доступно только для метода friends.get. 
Возвращаемые значения: 1 - находится, 0 - не находится.  
Если пользователь использует мобильное приложение либо мобильную версию сайта - будет возвращено дополнительное поле online_mobile. 

* lists - список, содержащий id списков друзей, в которых состоит текущий друг пользователя. Метод получения id и названий списков: friends.getLists. Поле доступно только для метода friends.get. Если текущий друг не состоит ни в одном списке, то при приёме данных в формате XML в узле <user> отсутствует тег lists. 

* screen_name - возвращает короткий адрес страницы (возвращается только имя адреса, например andrew). Если пользователь не менял адрес своей страницы, возвращается 'id'+uid, например id35828305. 

* has_mobile - показывает, известен ли номер мобильного телефона пользователя. 
Возвращаемые значения: 1 - известен, 0 - не известен. 
Рекомендуется перед вызовом метода secure.sendSMSNotification. 

* contacts - возвращает поля:
  * mobile_phone мобильный телефон пользователя 
  * home_phone домашний телефон пользователя

* education - возвращает код и название университета пользователя, а также факультет и год окончания.  

* universities - список высших учебных заведений, в которых учился текущий пользователь. 

* schools - список школ, в которых учился текущий пользователь. 

* can_post - разрешено ли оставлять записи на стене у данного пользователя. 

* can_see_all_posts - разрешено ли текущему пользователю видеть записи других пользователей на стене данного пользователя. 

* can_write_private_message - разрешено ли написание личных сообщений данному пользователю. 

* activity - возвращает статус, расположенный в профиле, под именем пользователя 

* last_seen - возвращает объект, содержащий поле time, в котором содержится время последнего захода пользователя. 

* relation - возвращает семейное положение пользователя: 
  * 1 - не женат/не замужем 
  * 2 - есть друг/есть подруга 
  * 3 - помолвлен/помолвлена 
  * 4 - женат/замужем 
  * 5 - всё сложно 
  * 6 - в активном поиске 
  * 7 - влюблён/влюблена 

* counters - возвращает количество различных объектов у пользователя. Поле возвращается только в методе getProfiles при запросе информации об одном пользователе. Данное поле является объектом, который содержит следующие поля:
  * albums - количество фотоальбомов
  * videos - количество видеозаписей
  * audios - количество аудиозаписей
  * notes - количество заметок
  * friends - количество друзей
  * groups - количество сообществ 
  * online_friends - количеcтво друзей онлайн
  * mutual_friends - количество общих друзей (если запрашивается информация не о текущем пользователе)
  * user_videos - количество видеозаписей с пользователем
  * followers - количество подписчиков

> Если запрашивается информация не о текущем пользователе, то отсуствие полей friends, online_friends, mutual_friends, user_photos в объекте означает, что информация по ним скрыта соотвествующими настройками приватности у запрашиваемого пользователя. Если при запросе данного поля оно отсутствует в ответе, то это означает, что текущий пользователь находится у запрашиваемого пользователя в черном списке. 

* wall_comments - разрешено ли комментирование стены. Если комментирование стены отключено - то комментарии на стене не отображаются. 

* relatives - возвращает список родственников текущего пользователя, в виде объектов, содержащих поля uid и type. type может принимать одно из следующих значений: grandchild, grandparent, child, sibling, parent. 

* interests, movies, tv, books, games, about - позволяют получить профильную информацию о пользователе.  

* connections - позволяет получить информацию о аккаунтах пользователя на других сервисах. При указании этого поля будут приходить следующие ключи в случае наличия соответствующих записей: twitter, facebook, facebook_name, skype, livejounal.




## Описание полей для объектов пользователей из социальной сети twitter
 
* follow_request_sent - отправленн ли запрос на подписку этому пользователю (true/false)
* profile_use_background_image - используется ли картинка в качестве фона в профайле пользователя
* time_zone - временная зона
* update_date - время последнего обращения системы к данным этого пользователя
* verified - проверен ли пользователь
* is_translator - принадлежит ли пользователь к сообществу переводчиков twitter
* followers_count - количество подписчиков пользователья
* protected - пользователь скрывает свои твиты, твиты показываются только его друзьям и подписчикам
* sn_id - идентификатор пользователя в социальной сети
* listed_count - количество публичных листов в которых состоит данный пользователь
* status - текущий статус пользователя (последнее сообщение):
  *  favorited - в избранном ли этот статус у бота
  *  text - текст статуса
  *  favorite_count - количество пользователей кто добавил этот статус себе в избранное
  *  lang - язык текста
  *  created_at - когда создан статус
  *  retweeted - был ли он переслан
  *  coordinates - координаты места где был сделан статус
  *  source - ресурс с которого был создан статус
  *  retweet_count - количество пересылок (репостов) статуса
  *  entities - сущности (которые есть также в сообщениях). Все атрибуты этого объекта являются массивами, и каждый элемент есть объект который содежит информацию о позиции в тексте:
    *    symbols : массив символов
    *    user_mentions : массив пользователей упоминаемых в тексте статуса
    *    hashtags : массив хэштегов 
    *    urls : массив ссылок

	
lang - основной язык пользователя
utc_offset - смещение по времени
statuses_count - количество статусов (сообщений пользователя)
description - то что пользователь написал о себе
friends_count - количество друзей (аккаунтов на которые рассматриваемый аккаунт подписан)
geo_enabled - индикатор того позволил ли пользователь вставлять в свои твиты гео-теги
profile_background_tile - узор фона
favourites_count - количество избранных объектов у пользователя
screen_name - ник
url - ссылка которую указал пользователь в своем описании
created_at - когда был создан аккаунт
default_profile - настроил ли пользователь свой аккаунт (дополнительной индивидуальностью, к примеру картинкой в фоне)
following - читает ли текущий бот искомого пользователя

Существуют несколько типов извлекаемых данных: 
1) User, пользователи социальной сети. Находящиеся в коллекии users и имеющие различные поля в зависимости от ресурса. В любом случае, каждый документ в коллекии обладает следующими полями вне зависимости от ресурса: 
	1) source - собственно имя ресурса (ttr - твиттер, vk - вконтакте, fb - фейсбук)
	2) name и <[first, last, middle]>_name - имя пользователя, который он указал при регистрации
	3) sn_id - идентификатор пользователя в социальной сети
	4) status - последнее его сообщение (либо его состояние, которое он указал в графе "Что с вами происходит?")
	5) birthday - дата рождения
	6) screen_name - ник
	!7) persist_date, lastseen_date - время сохранения в БД и время последнего просмотра ! переделай это на уровне БД, так чтобы если извлекаем этого пользователя, то обновлять lastseen_date/
	!8) [followers, friends]_count - количество подписчиков и друзей пользователя соостветственно ! извлеки в БД для контакта

2) Message - сообщения пользователей. Из twitter это сосбтвенно сообщений которые написал пользователь, из vk - это сообщения со стены и комментарии которые которые оставлил другие пользователи. Общие поля таковы: 
	1) source - собственно имя ресурса (ttr - твиттер, vk - вконтакте, fb - фейсбук)
	2) text - текст сообщения
	!3) created_date - время создания сообщения ! переименуй, вообще придерживайся стандарту что если что-то датированое то в конце будет date
	4) sn_id - идентиикатор сообщения в социальной сети (для vk состоит из строчки тип_идентификатор пользователя_идетификатор сообщения у этого пользователя)
	5) user - ссылка на пользователя 

3) SocialObject - актуально только для социальных сетей vk, fb. Характеризует группу пользователей: некоторый объект который имеет свой контент (список обсуждений, фотографии, видео, и прочее). 
4) ContentObject - контентный объект пользователя или группыпользователей (фотография, видео, обсуждение чего-либо). Актуально только для социальных сетей vk, fb. 

	 

Об данных извлекаемых из социальной сети vk: 
Все объекты извлекаемые из социальной сети vk, а именно: User, Message, SocialObject, ContentObject имеют атрибут source, значние которого равно vk. 

Под ContentObject понимаются некоторые контентные объекты такие как фотографии, видео, обсуждения групп. Все эти объекты имеют различные наборы атрибутов в зависимости от типа обхекта, а также к каждому из них могут привязываться Message посредством информации из атрибута comment_for. Также для каждого такого объекта определены слеующие поля:
	text - текстовая информация об объекте, которую указал пользователь при загрузке
	type - тип этого объекта (возможны следующие виды:group_topic, photo, photo_album, video)
	user за исключение
!сделай коммент фор через идишиник.


Под SocialObject понимаются соединения пользователей такие как: группы, публичные страницы, встречи и различаются свойством type.
Для каждого объекта SocialObject определены следующие поля: 
	sn_id - иеднтификатор соединения в социальной сети vk	
	private - закрыта ли это соединение для сторонних пользователей (чтобы вступить требуется отправить запрос адиминистратору этого соединения)
	name - видное всем пользователям имя соединения.
	screen_name - "ник" группы
	type - тип соединения (может быть group, page, event)
	source - всегда равен vk


